{% extends "usuarios/instructor/instructor_base.html" %}
{% block title %}Ubicación en Tiempo Real{% endblock %}
{% load static %}

{% block instructor_content %}
<style>
  .map-container {
    position: relative;
    width: 100%;
    max-width: 800px;
    margin: auto;
    border: 2px solid #000000;
    border-radius: .25rem;
    background-color: #ffffff;
  }

  .location-dot {
    position: absolute;
    width: 20px;
    height: 20px;
    background-color: #39A900; /* Verde SENA */
    border-radius: 50%;
    border: 3px solid #ffffff;
    box-shadow: 0 0 10px rgba(57, 169, 0, 0.8);
    transform: translate(-50%, -50%); /* Centra el punto en las coordenadas */
    transition: top 1s ease-in-out, left 1s ease-in-out; /* Animación suave */
  }

  .location-dot::after {
    content: 'Tú';
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #000000;
    color: #ffffff;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
  }

  /* Estilos para el plano HTML */
  .map-layout {
    position: relative;
    width: 100%;
    height: 450px; /* Altura fija para el plano */
    background-color: #ffffff; /* Blanco */
    padding: 20px;
    box-sizing: border-box;
  }

  .corridor {
    position: absolute;
    background-color: #000000; /* Negro */
  }

  .corridor-h {
    width: 100%;
    height: 15%;
    top: 42.5%;
    left: 0;
  }

  .corridor-v {
    width: 10%;
    height: 100%;
    left: 45%;
    top: 0;
  }

  .room {
    position: absolute;
    background-color: #39A900; /* Verde SENA */
    border: 1px solid #000000;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: #ffffff;
    text-align: center;
    transition: background-color 0.3s ease;
  }

  .room.highlight {
    background-color: #ffffff; /* Blanco para resaltado */
    color: #39A900;
    border-color: #000000;
  }

  /* Posicionamiento de los ambientes (ejemplo) */
  #ambiente-301 { top: 5%; left: 5%; width: 35%; height: 30%; }
  #ambiente-302 { top: 5%; right: 5%; width: 35%; height: 30%; }
  #ambiente-303 { top: 65%; left: 5%; width: 15%; height: 30%; }
  #ambiente-205 { top: 65%; left: 25%; width: 15%; height: 30%; }
  #ambiente-cafeteria { bottom: 5%; right: 5%; width: 35%; height: 30%; }
  #ambiente-101 { top: 65%; left: 60%; width: 15%; height: 30%; }

</style>

<div class="card p-4 shadow-sm">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h5 class="mb-0">Mi Ubicación en Tiempo Real</h5>
  </div>

  <!-- Buscador de Ambientes -->
  <div class="input-group mb-3 mx-auto" style="max-width: 400px;">
    <input type="text" id="searchInput" class="form-control" placeholder="Buscar ambiente por número (ej: 301, cafeteria)...">
    <button class="btn btn-primary" type="button" id="searchButton"><i class="bi bi-search"></i> Buscar</button>
  </div>

  <div class="map-container">
    <!-- Plano del edificio con HTML y CSS -->
    <div class="map-layout">
      <!-- Pasillos -->
      <div class="corridor corridor-h"></div>
      <div class="corridor corridor-v"></div>

      <!-- Ambientes -->
      <div id="ambiente-301" class="room">Ambiente 301</div>
      <div id="ambiente-302" class="room">Ambiente 302</div>
      <div id="ambiente-303" class="room">Ambiente 303</div>
      <div id="ambiente-205" class="room">Ambiente 205<br>(Multimedia)</div>
      <div id="ambiente-cafeteria" class="room">Cafetería</div>
      <div id="ambiente-101" class="room">Auditorio</div>

      <!-- Punto de ubicación del usuario -->
      <div id="userLocation" class="location-dot" style="left: {{ posicion.x }}%; top: {{ posicion.y }}%;"></div>
    </div>
  </div>
  <p class="text-center text-muted mt-3">
    <i class="bi bi-info-circle-fill"></i>
    Este es un mapa de prueba. Tu ubicación simulada se actualizará periódicamente.
  </p>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const locationDot = document.getElementById('userLocation');
  const searchButton = document.getElementById('searchButton');
  const searchInput = document.getElementById('searchInput');

  // Simular actualización de GPS cada 5 segundos
  setInterval(() => {
    // Coordenadas aleatorias dentro del 90% del mapa para que no se salga de los bordes
    const newX = Math.random() * 90 + 5;
    const newY = Math.random() * 90 + 5;
    locationDot.style.left = `${newX}%`;
    locationDot.style.top = `${newY}%`;
  }, 5000);

  // Funcionalidad de búsqueda
  searchButton.addEventListener('click', function() {
    const query = searchInput.value.trim().toLowerCase();
    if (!query) return;

    // Quitar resaltado anterior
    const highlighted = document.querySelector('.room.highlight');
    if (highlighted) {
      highlighted.classList.remove('highlight');
    }

    // Buscar y resaltar el nuevo ambiente
    const targetRoom = document.getElementById(`ambiente-${query}`);
    if (targetRoom) {
      targetRoom.classList.add('highlight');
    } else {
      alert('Ambiente no encontrado. Intenta con: 301, 302, 303, 205, 101, cafeteria.');
    }
  });

  // Permitir buscar con la tecla Enter
  searchInput.addEventListener('keyup', (event) => event.key === 'Enter' && searchButton.click());
});
</script>
{% endblock %}