{% extends "usuarios/admin/admin_base.html" %}
{% block title %}Gestionar Aprendices de Ficha #{{ ficha.numero }}{% endblock %}

{% block admin_content %}
<div class="card p-4 shadow-sm">
  <div class="mb-4">
    <a href="{% url 'admin_fichas' %}" class="btn btn-outline-secondary btn-sm">
      <i class="bi bi-arrow-left"></i> Volver a Fichas
    </a>
    <h5 class="mt-3">Gestionar Aprendices de la Ficha #{{ ficha.numero }}</h5>
    <p class="text-muted">{{ ficha.programa.nombre }} - Jornada {{ ficha.jornada }}</p>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="row">
    <!-- Columna de Aprendices en la Ficha -->
    <div class="col-md-6">
      <h6><i class="bi bi-people-fill text-success"></i> Aprendices en esta Ficha ({{ aprendices_en_ficha.count }})</h6>
      <div class="list-group">
        {% for aprendiz in aprendices_en_ficha %}
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              {{ aprendiz.get_full_name|default:aprendiz.username }}
              <small class="d-block text-muted">{{ aprendiz.email }}</small>
            </div>
            <form action="{% url 'admin_ficha_remover_aprendiz' ficha_id=ficha.id usuario_id=aprendiz.id %}" method="post">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-danger" title="Quitar de la ficha">
                <i class="bi bi-x-circle"></i>
              </button>
            </form>
          </div>
        {% empty %}
          <div class="list-group-item text-muted">No hay aprendices en esta ficha.</div>
        {% endfor %}
      </div>
    </div>

    <!-- Columna de Aprendices Disponibles -->
    <div class="col-md-6">
      <h6><i class="bi bi-person-plus-fill text-primary"></i> Aprendices Disponibles ({{ aprendices_disponibles.count }})</h6>
      <div class="list-group">
        {% for aprendiz in aprendices_disponibles %}
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              {{ aprendiz.get_full_name|default:aprendiz.username }}
              <small class="d-block text-muted">{{ aprendiz.email }}</small>
            </div>
            <form action="{% url 'admin_ficha_agregar_aprendiz' ficha_id=ficha.id usuario_id=aprendiz.id %}" method="post">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-success" title="AÃ±adir a la ficha" {% if ficha.aprendices.count >= ficha.cupo_maximo %}disabled{% endif %}>
                <i class="bi bi-plus-circle"></i>
              </button>
            </form>
          </div>
        {% empty %}
          <div class="list-group-item text-muted">No hay aprendices disponibles sin ficha.</div>
        {% endfor %}
      </div>
    </div>
  </div>

</div>
{% endblock %}